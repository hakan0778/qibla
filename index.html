<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>KÄ±ble Test</title>
  <style>
    body { font-family: Arial, sans-serif; }
    #map { width: 100%; height: 80vh; margin-top: 10px; }
    button { padding: 8px 12px; margin-right: 6px; }
  </style>
</head>
<body>

<h2>ğŸ§­ KÄ±ble Test</h2>

<button onclick="getLocation()">ğŸ“ Konum al</button>
<div id="info"></div>

<div id="map"></div>

<script>
let map;
let userMarker;
let qiblaLine;

// KÃ¢be koordinatlarÄ±
const KAABA = { lat: 21.4225, lng: 39.8262 };

function initMap() {
  map = new google.maps.Map(document.getElementById("map"), {
    zoom: 5,
    center: KAABA,
  });

  new google.maps.Marker({
    position: KAABA,
    map: map,
    title: "KÃ¢be",
  });
}

function getLocation() {
  if (!navigator.geolocation) {
    alert("Konum desteklenmiyor");
    return;
  }

  navigator.geolocation.getCurrentPosition(
    (pos) => {
      const userPos = {
        lat: pos.coords.latitude,
        lng: pos.coords.longitude,
      };

      if (userMarker) userMarker.setMap(null);
      if (qiblaLine) qiblaLine.setMap(null);

      userMarker = new google.maps.Marker({
        position: userPos,
        map: map,
        title: "Senin konumun",
      });

      qiblaLine = new google.maps.Polyline({
        path: [userPos, KAABA],
        geodesic: true,
        strokeColor: "#FF0000",
        strokeOpacity: 1.0,
        strokeWeight: 3,
        map: map,
      });

      map.setCenter(userPos);
      map.setZoom(6);

      const angle = calculateQiblaAngle(
        userPos.lat,
        userPos.lng,
        KAABA.lat,
        KAABA.lng
      );

      document.getElementById("info").innerHTML =
        `âœ… Konum alÄ±ndÄ±<br>ğŸ§­ KÄ±ble yÃ¶nÃ¼: <b>${angle.toFixed(1)}Â°</b>`;
    },
    () => alert("Konum alÄ±namadÄ±")
  );
}

function calculateQiblaAngle(lat1, lon1, lat2, lon2) {
  const Ï†1 = lat1 * Math.PI / 180;
  const Ï†2 = lat2 * Math.PI / 180;
  const Î”Î» = (lon2 - lon1) * Math.PI / 180;

  const y = Math.sin(Î”Î»);
  const x =
    Math.cos(Ï†1) * Math.tan(Ï†2) -
    Math.sin(Ï†1) * Math.cos(Î”Î»);

  let Î¸ = Math.atan2(y, x) * 180 / Math.PI;
  return (Î¸ + 360) % 360;
}
</script>

<script
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDjjTLQSqrvhjuG6N22cP7MiOdnvYZiSUQ&callback=initMap"
  async defer>
</script>

</body>
</html>
