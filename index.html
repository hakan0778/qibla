<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Qibla Map Test</title>

  <style>
    html, body { height: 100%; margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    #map { height: 100%; width: 100%; }
    .panel {
      position: fixed; left: 12px; top: 12px; z-index: 9999;
      background: rgba(255,255,255,.95); border: 1px solid #ddd; border-radius: 12px;
      padding: 10px 12px; max-width: 360px; box-shadow: 0 8px 24px rgba(0,0,0,.12);
    }
    .panel b { display:block; margin-bottom:6px; }
    .row { display:flex; gap:8px; flex-wrap: wrap; }
    button {
      border: 1px solid #ccc; background: #fff; border-radius: 10px;
      padding: 8px 10px; cursor: pointer;
    }
    button:hover { background:#f6f6f6; }
    #status { margin-top:8px; font-size: 12px; white-space: pre-wrap; }
    .ok { color: #0a7a0a; }
    .bad { color: #b00020; }
    .hint { color:#333; opacity:.9; }
  </style>
</head>

<body>
  <div class="panel">
    <b>Google Maps Test</b>
    <div class="row">
      <button onclick="tryGeolocate()">üìç Konum al</button>
      <button onclick="centerToSide()">üß≠ Side</button>
      <button onclick="showConsoleHint()">‚ÑπÔ∏è Hata nasƒ±l bakƒ±lƒ±r?</button>
    </div>
    <div id="status" class="hint">Y√ºkleniyor...</div>
  </div>

  <div id="map"></div>

  <script>
    // 1) BURAYA API KEY'ƒ∞Nƒ∞ YAPI≈ûTIR
    const API_KEY = AIzaSyDjjTLQSqrvhjuG6N22cP7MiOdnvYZiSUQ;

    // 2) Basit durum yazƒ±cƒ±sƒ±
    const statusEl = document.getElementById("status");
    function setStatus(msg, ok=false){
      statusEl.className = ok ? "ok" : "bad";
      statusEl.textContent = msg;
    }
    function setHint(msg){
      statusEl.className = "hint";
      statusEl.textContent = msg;
    }

    // 3) G√ºvenlik: HTTPS deƒüilse Maps bazen sapƒ±tƒ±yor
    (function checkHttps(){
      if (location.protocol !== "https:" && location.hostname !== "localhost") {
        setStatus("‚ö†Ô∏è Bu sayfa HTTPS deƒüil.\nGitHub Pages √ºzerinden a√ßmalƒ±sƒ±n.\n√ñrn: https://hakan0778.github.io/qibla/", false);
      } else {
        setHint("‚úÖ Sayfa HTTPS. ≈ûimdi Maps scripti y√ºkleniyor...");
      }
    })();

    // 4) Google Maps scriptini dinamik ekle (API key bo≈üsa hemen yakalar)
    (function loadMaps(){
      if (!API_KEY || API_KEY === "YOUR_API_KEY_HERE") {
        setStatus("‚ùå API_KEY bo≈ü.\nYOUR_API_KEY_HERE yazan yere kendi key‚Äôini yapƒ±≈ütƒ±r.", false);
        return;
      }

      // Scripti ekle
      const s = document.createElement("script");
      s.src = `https://maps.googleapis.com/maps/api/js?key=${encodeURIComponent(API_KEY)}&v=weekly&callback=initMap`;
      s.async = true;
      s.defer = true;

      s.onerror = () => {
        setStatus("‚ùå Google Maps script y√ºklenemedi.\n- Key yanlƒ±≈ü olabilir\n- Restriction (Website) hatalƒ± olabilir\n- Billing baƒülƒ± deƒüilse hata verebilir\nDetay i√ßin Console'a bak.", false);
      };

      document.head.appendChild(s);
    })();

    // 5) Maps init
    let map, marker;

    window.initMap = function initMap() {
      try {
        // Side (Antalya) yakƒ±nlarƒ± default
        const side = { lat: 36.7667, lng: 31.3886 };

        map = new google.maps.Map(document.getElementById("map"), {
          center: side,
          zoom: 12,
          mapTypeControl: false,
          fullscreenControl: true,
          streetViewControl: false
        });

        marker = new google.maps.Marker({ position: side, map, title: "Side" });

        setStatus("‚úÖ Harita y√ºklendi! ≈ûimdi 'Konum al' ile test et.", true);

        // Hata yakalama: Google Maps bazen auth hatasƒ±nƒ± console'a basar
        window.gm_authFailure = function() {
          setStatus(
            "‚ùå gm_authFailure: API KEY yetkisiz.\n" +
            "√á√ñZ√úM:\n" +
            "1) Google Cloud > Credentials > API Key\n" +
            "2) Application restrictions: Websites\n" +
            "   - https://hakan0778.github.io/* (veya) https://hakan0778.github.io/qibla/*\n" +
            "3) API restrictions: Sadece 'Maps JavaScript API' se√ßili olsun\n" +
            "4) Billing proje baƒülƒ± olmalƒ±",
            false
          );
        };

      } catch (e) {
        setStatus("‚ùå initMap i√ßinde hata:\n" + (e?.message || e), false);
      }
    };

    // 6) Konum al (opsiyonel)
    function tryGeolocate(){
      if (!navigator.geolocation) {
        setStatus("‚ùå Bu cihaz konum desteklemiyor.", false);
        return;
      }
      setHint("üìç Konum isteniyor... (izin ver)");

      navigator.geolocation.getCurrentPosition(
        (pos) => {
          const p = { lat: pos.coords.latitude, lng: pos.coords.longitude };
          if (map) {
            map.setCenter(p);
            map.setZoom(15);
            marker.setPosition(p);
            marker.setTitle("Konumun");
            setStatus("‚úÖ Konum alƒ±ndƒ± ve harita ortalandƒ±.", true);
          } else {
            setStatus("‚ö†Ô∏è Harita yok ama konum geldi: " + JSON.stringify(p), false);
          }
        },
        (err) => {
          setStatus("‚ùå Konum hatasƒ±:\n" + err.message, false);
        },
        { enableHighAccuracy: true, timeout: 12000, maximumAge: 0 }
      );
    }

    function centerToSide(){
      const side = { lat: 36.7667, lng: 31.3886 };
      if (!map) { setStatus("‚ö†Ô∏è Harita hen√ºz y√ºklenmedi.", false); return; }
      map.setCenter(side);
      map.setZoom(12);
      marker.setPosition(side);
      marker.setTitle("Side");
      setStatus("‚úÖ Side'a d√∂nd√ºm.", true);
    }

    function showConsoleHint(){
      setHint(
        "Console a√ß:\n" +
        "- PC Chrome: F12 > Console\n" +
        "- Safari iPhone: Ayarlar > Safari > Geli≈ümi≈ü > Web Denet√ßisi\n" +
        "Eƒüer hata varsa ekran g√∂r√ºnt√ºs√º at."
      );
    }
  </script>
</body>
</html>
